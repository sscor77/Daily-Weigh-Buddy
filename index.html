<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WeighBuddy</title>

  <!-- Manifest y colores -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#3a0ca3">

  <!-- Iconos -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Estilos externos -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1><i class="fa-solid fa-weight-scale"></i> WeighBuddy</h1>
    <p>Tu compaÃ±ero para seguir tu progreso</p>
  </header>

  <main>
    <section class="card">
      <h2>Datos personales</h2>
      <label for="startWeight">Peso inicial (kg):</label>
      <input type="number" id="startWeight">

      <label for="height">Altura (cm):</label>
      <input type="number" id="height">

      <label for="goal">Meta de peso (kg):</label>
      <input type="number" id="goal">

      <button onclick="saveProfile()"><i class="fa-solid fa-user-check"></i> Guardar perfil</button>
    </section>

    <section class="card">
      <h2>Seguimiento</h2>
      <label for="weight">Nuevo peso (kg):</label>
      <input type="number" id="weight">
      <button onclick="addWeight()"><i class="fa-solid fa-plus"></i> AÃ±adir peso</button>

      <div id="results"></div>
      <canvas id="weightChart"></canvas>
    </section>
  </main>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- LÃ³gica -->
  <script>
    let profile = JSON.parse(localStorage.getItem("profile")) || { startWeight: null, height: null, goal: null };
    let weights = JSON.parse(localStorage.getItem("weights")) || [];

    const ctx = document.getElementById("weightChart").getContext("2d");
    let chart = new Chart(ctx, {
      type: "line",
      data: {
        labels: weights.map((_, i) => `DÃ­a ${i+1}`),
        datasets: [{
          label: "Peso (kg)",
          data: weights,
          borderColor: "#3a0ca3",
          backgroundColor: "rgba(58,12,163,0.2)",
          fill: true,
          tension: 0.3,
          pointRadius: 5,
          pointBackgroundColor: "#7209b7"
        }]
      },
      options: {
        plugins: {
          legend: { display: false }
        }
      }
    });

    function saveProfile() {
      profile.startWeight = parseFloat(document.getElementById("startWeight").value);
      profile.height = parseFloat(document.getElementById("height").value);
      profile.goal = parseFloat(document.getElementById("goal").value);
      localStorage.setItem("profile", JSON.stringify(profile));
      updateResults();
    }

    function addWeight() {
      const weightInput = document.getElementById("weight");
      const weight = parseFloat(weightInput.value);
      if (!isNaN(weight)) {
        weights.push(weight);
        localStorage.setItem("weights", JSON.stringify(weights));
        updateChart();
        weightInput.value = "";
      }
    }

    function updateChart() {
      chart.data.labels = weights.map((_, i) => `DÃ­a ${i+1}`);
      chart.data.datasets[0].data = weights;
      chart.update();
      updateResults();
    }

    function updateResults() {
      if (profile.startWeight && profile.goal) {
        const last = weights[weights.length - 1] || profile.startWeight;
        const diff = last - profile.goal;
        const resultText = diff > 0 
          ? `Te faltan ${diff.toFixed(1)} kg para tu meta.`
          : `Â¡Has alcanzado tu meta! ðŸŽ‰`;
        document.getElementById("results").innerText = 
          `Ãšltimo peso: ${last} kg\n${resultText}`;
      }
    }

    if (profile.startWeight) document.getElementById("startWeight").value = profile.startWeight;
    if (profile.height) document.getElementById("height").value = profile.height;
    if (profile.goal) document.getElementById("goal").value = profile.goal;
    updateChart();
  </script>

  <!-- Registrar Service Worker -->
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/sw.js")
        .then(() => console.log("Service Worker registrado"))
        .catch(err => console.error("Error al registrar SW:", err));
    }
  </script>
</body>
</html>
